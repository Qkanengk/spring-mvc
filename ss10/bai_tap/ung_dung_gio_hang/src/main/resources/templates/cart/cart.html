<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        body { background-color: #f8f9fa; }

        .cart-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Chỉnh ảnh sản phẩm nhỏ gọn trong bảng */
        .product-img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
        }

        /* Căn giữa nội dung trong ô bảng */
        .table td {
            vertical-align: middle;
        }

        /* Khung tổng tiền bên phải */
        .summary-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            position: sticky; /* Giữ cố định khi cuộn trang */
            top: 20px;
        }
    </style>
</head>
<body>

<div class="container py-5 cart-container">
    <h2 class="mb-4 fw-bold">Shopping Cart</h2>

    <div class="row">
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-0">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                        <tr>
                            <th class="ps-4">Product</th>
                            <th class="text-center">Quantity</th>
                            <th class="text-end">Price</th>
                            <th class="text-end pe-4">Total</th>
                            <th></th> </tr>
                        </thead>
                        <tbody>
                        <tr th:each="entry : ${cart.products}">
                            <td class="ps-4">
                                <div class="d-flex align-items-center">
                                    <img th:src="${entry.key.image}" class="product-img me-3" alt="Product">
                                    <div>
                                        <h6 class="mb-0 fw-bold" th:text="${entry.key.name}">Product Name</h6>
                                        <small class="text-muted">ID: <span th:text="${entry.key.id}"></span></small>
                                    </div>
                                </div>
                            </td>

                            <td>
                                <div class="input-group input-group-sm mx-auto" style="width: 100px;">
                                    <a th:href="@{/cart/update/__${entry.key.id}__(qty=${entry.value - 1})}"
                                       class="btn btn-outline-secondary btn-sm">-</a>

                                    <input type="text" class="form-control text-center bg-white"
                                           th:value="${entry.value}" readonly>

                                    <a th:href="@{/cart/update/__${entry.key.id}__(qty=${entry.value + 1})}"
                                       class="btn btn-outline-secondary btn-sm">+</a>
                                </div>
                            </td>

                            <td class="text-end"
                                th:text="${#numbers.formatDecimal(entry.key.price, 0, 0)} + ' đ'">
                                100.000 đ
                            </td>

                            <td class="text-end fw-bold pe-4"
                                th:text="${#numbers.formatDecimal(entry.key.price * entry.value, 0, 0)} + ' đ'">
                                200.000 đ
                            </td>

                            <td class="text-end pe-4">
                                <a th:href="@{/cart/remove/__${entry.key.id}__}"
                                   class="text-danger" title="Remove item">
                                    <i class="fas fa-trash"></i>
                                </a>
                            </td>
                        </tr>

                        <tr th:if="${cart.products.isEmpty()}">
                            <td colspan="5" class="text-center py-5">
                                <p class="text-muted">Your cart is empty.</p>
                                <a href="/shop" class="btn btn-primary">Go Shopping</a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="mt-3">
                <a href="/shop" class="text-decoration-none">
                    <i class="fas fa-arrow-left me-2"></i> Continue Shopping
                </a>
            </div>
        </div>

        <div class="col-lg-4 mt-4 mt-lg-0">
            <div class="summary-card p-4">
                <h4 class="fw-bold mb-4">Order Summary</h4>

                <div class="d-flex justify-content-between mb-2">
                    <span class="text-muted">Total Items:</span>
                    <span class="fw-bold" th:text="${cart.countItemQuantity()}">0</span>
                </div>

                <div class="d-flex justify-content-between mb-2">
                    <span class="text-muted">Total Products:</span>
                    <span class="fw-bold" th:text="${cart.countProductQuantity()}">0</span>
                </div>

                <hr>

                <div class="d-flex justify-content-between mb-4">
                    <span class="h5 fw-bold">Total Payment:</span>
                    <span class="h5 fw-bold text-primary"
                          th:text="${#numbers.formatDecimal(cart.countTotalPayment(), 0, 0)} + ' đ'">
                        0 đ
                    </span>
                </div>

                <div class="d-grid gap-2">
                    <a href="/checkout" class="btn btn-dark btn-lg">
                        Proceed to Checkout
                    </a>
                </div>

                <div class="mt-4 text-center text-muted">
                    <small>We accept</small><br>
                    <i class="fab fa-cc-visa fa-2x mx-1"></i>
                    <i class="fab fa-cc-mastercard fa-2x mx-1"></i>
                    <i class="fab fa-cc-paypal fa-2x mx-1"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>